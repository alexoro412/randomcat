<!DOCTYPE html>


<html>

  <head>
    <title>Random Cat</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-material-design.min.css" rel="stylesheet">
    <link href="css/ripples.min.css" rel="stylesheet">
    <link href="css/snackbar.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  </head>

  <body>
    <style>
      html, body{
        margin:0px;
        border:0px;
        padding:0px;
      }
      #cat{
        width: 100%;
        max-width:100%;
      }
      a[disabled] {
        pointer-events: none;
      }
      #next-mobile{
        position:fixed;
        bottom:30px;
        right:30px;
        z-index:10;
        transform:scale(1.5,1.5);
      }
      .btn-fab:focus, .btn-fab:active, .btn-fab:enabled{
        background-color: #3f51b5 !important;
        color: #ffffff !important;
      }
      #snackbar-container{
        z-index:9;
      }
      #star-overlay{
        position:fixed;
        text-align: center;
        /*opacity: 0.5;*/
        /*background-color: #ffffff;*/
        width:100%;
        height:100%;
        z-index:12;
        display: table;
        /*display: none;*/
        /*vertical-align: middle;*/
      }
      #actual-overlay{
        position:fixed;
        text-align: center;
        opacity: 0.5;
        background-color: #ffffff;
        width:100%;
        height:100%;
        z-index:12;
        display: table;
        /*vertical-align: middle;*/
      }
      #star-overlay > span{
        display: table-cell;
        vertical-align: middle;
        font-size:1000%;
        color: rgba(200, 200, 200, 1);
        /*opacity: 0;*/
        /*width: auto;
        height: auto;*/
        /*opacity: 1 !important;*/
      }
    </style>

    <button onclick="nextCat()" class="btn btn-inverse btn-lg btn-fab pull-right visible-xs" id="next-mobile">
      <span class="glyphicon glyphicon-arrow-right material-icons"></span>
    </button>

    <div id="star-overlay" >
      <div id="actual-overlay"></div>
      <span id="overlaid-star" class="glyphicon glyphicon-star"></span>
    </div>

    <nav class="navbar navbar-primary">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapsed-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
         <a class="navbar-brand" href="#">Random Cat <sup><small>BETA</small></sup></a>
       </div>

       <div class="collapse navbar-collapse" id="collapsed-navbar">
        <ul class="nav navbar-nav">
          <li class="active"><a href="index.html">Home <span class="sr-only">(current)</span></a></li>
          <li><a href="saved.html">Starred</a></li>
          <li><a href="search.html">Search</a></li>
          <li><a href="https://docs.google.com/forms/d/1S96vLKMgIRiEKRsmWTMGti--Y8rOS_gWra5slXhCxGM/viewform">Feedback</a></
        </ul>
      </div>

     </div>
    </nav>

    <div class="col-md-7 col-md-offset-1">
      <div class="panel panel-primary">
        <div class="panel-heading">

          <h2 id="picture-title" class="panel-title">Random Cat</h2>

        </div>
        <div class="panel-body cat-img-container">

          <img src="loading.gif" id="cat"/>
        </div>
      </div>
    </div>

    <div class="col-md-offset-1 col-md-3">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">Random Cat</h3>
        </div>
        <div class="panel-body">
          <p>
              <button id="next-cat" type="button" class="btn btn-lg btn-block btn-primary" onclick="nextCat()">
                Next cat&nbsp;<span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
              </button>
          </p>

          <p>
            <a id="download-link" href="loading.gif" download>
              <button id="download-btn" type="button" class="btn btn-lg btn-block btn-primary">
                Download&nbsp;<span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
              </button>
            </a>
          </p>

          <p>
            <button type="button" class="btn btn-lg btn-primary btn-block" onclick="starCurrent()" id="star-btn">
              Star Cat &nbsp; <span class="glyphicon glyphicon-star"></span>
            </button>
          </p>

          <p>
            <a href="" id="sourcelink">
              <button id="view-btn" type="button" class="btn btn-lg btn-primary btn-block">
                View Cat &nbsp;<span class="glyphicon glyphicon-eye-open"></span>
              </button>
            </a>
          </p>

          <div class="input-group">
            <span class="input-group-addon">URL</span>
            <input id="sourceurl" type="text" class="form-control" readonly value="">
          </div>
        </div>
      </div>

      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">About Random Cat</h3>
        </div>
        <div class="panel-body">
          <p>
            <small>
              <p>
                Special thanks to <a href="http://thecatapi.com/">The Cat API</a>
              </p>
              <p>
                <a href="https://jquery.com/">jQuery</a>
                |
                <a href="http://getbootstrap.com/">Bootstrap</a>
                |
                <a href="http://fezvrasta.github.io/bootstrap-material-design/">Bootstrap Theme</a>
              </br>

                <a href="https://github.com/FezVrasta/snackbarjs">Snackbar</a>
                |
                <a href="http://bootboxjs.com/">Bootbox</a>
                |
                <a href="https://github.com/js-cookie/js-cookie">js-cookie</a>
              </p>
              <p>
                Made by <a href="https://github.com/alexoro412/"> alexoro412</a>
              </p>
              <p>
                This site uses cookies for keeping your starred cats
              </p>
              <p>
                I take no responsbility for any of these pictures whatsoever
              </p>
            </small>
          </p>
        </div>
      </div>
    </div>

    <!-- <div id="snackbar-container" class="visible-md visible-lg"></div> -->

    <script src="js/jquery-2.2.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/snackbar.min.js"></script>
    <script src="js/js-cookie.js"></script>
    <script src="js/bootbox.js"></script>
    <script src="js/ripples.min.js"></script>
    <script src="js/material.min.js"></script>
    <script src="js/jquery.touchSwipe.js"></script> <!-- find link -->

    <script>$.material.init();</script>


    <script>
      currentCatId = "";
      starred = false;

      buffer = [];

      if(Cookies.getJSON("saved") == undefined){
        Cookies.set("saved", []);
      }

      // if (window.location.protocol != "http:"){
      //   window.location.href = "http:" + window.location.href.substring(window.location.protocol.length);
      // }
      /**
      *   Takes an xml resonse from The Cat API and displays the cat
      */
      // function displayCat(xml) {
      //     var xmlDoc = xml.responseXML;
      //
      //     var id = xmlDoc.getElementsByTagName('id')[0].innerHTML;
      //     var download_link = document.getElementById("download-link");
      //     var url = xmlDoc.getElementsByTagName("url")[0].innerHTML;
      //     var img = document.getElementById("cat");
      //
      //
      //     img.src = url;
      //     currentCatId = id
      //
      //     download_link.href = url;
      //     download_link.download = currentCatId;
      //     document.getElementById("next-cat").disabled = false;
      //     document.getElementById("next-mobile").disabled = false;
      //     document.getElementById("download-btn").disabled = false;
      //     document.getElementById("sourceurl").value = "https://alexoro412.github.com/randomcat/single.html?id=" + id;
      //     document.getElementById("sourcelink").href = "single.html?id=" + id;
      //     document.getElementById("picture-title").innerHTML = id;
      //     document.getElementById("star-btn").disabled = false;
      //     document.getElementById("view-btn").disabled = false;
      //     checkStarred(id);
      // }

      function bufferCats(xml){
        var xmlDoc = xml.responseXML;
        var ids = xmlDoc.getElementsByTagName("id");
        for(var i = 0; i < ids.length; i++){
          buffer.push(ids[i].innerHTML);
        }
      }

      function nextCat(){

        if(buffer.length < 7){
          console.log("woops");
          get();
        }
        if(buffer.length <= 0){
          console.log(":D");
          setTimeout(nextCat, 500);
          return;
        }

        // console.log("h");
        var id = buffer.shift();
        var download_link = document.getElementById("download-link");

         //xmlDoc.getElementsByTagName("url")[0].innerHTML;
        var img = document.getElementById("cat");

        var url = "https://thecatapi.com/api/images/get.php?id=" + id;

        currentCatId = id

        document.getElementById("star-btn").disabled = true;
        document.getElementById("next-cat").disabled = true;
        document.getElementById("next-mobile").disabled = true;
        document.getElementById("sourcelink").href = "#";
        document.getElementById("sourceurl").value = "";
        document.getElementById("download-link").href = "#";
        document.getElementById("download-btn").disabled = true;
        document.getElementById("view-btn").disabled = true;
        document.getElementById("picture-title").innerHTML = "loading";
        console.log("here!");

        img.src = url;
        checkStarred(id);



      }

      document.getElementById("cat").onload = function(){
        console.log("loaded");
        var id = currentCatId;
        var url = "https://thecatapi.com/api/images/get.php?id=" + id;
        var download_link = document.getElementById("download-link");
        download_link.href = url;
        download_link.download = currentCatId;
        document.getElementById("next-cat").disabled = false;
        document.getElementById("next-mobile").disabled = false;
        document.getElementById("download-btn").disabled = false;
        document.getElementById("sourceurl").value = "https://alexoro412.github.com/randomcat/single.html?id=" + id;
        document.getElementById("sourcelink").href = "single.html?id=" + id;
        document.getElementById("picture-title").innerHTML = id;
        document.getElementById("star-btn").disabled = false;
        document.getElementById("view-btn").disabled = false;

      }

      /**
      *   Gets a random cat from The Cat API, then calls display cat
      */
      function get(){
        if(buffer.length > 15) return;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
              bufferCats(xhttp);
            }
        };

        // var img = document.getElementById("cat");
        // img.src = "loading.gif";
        xhttp.open("GET", "https://thecatapi.com/api/images/get?format=xml&results_per_page=10", true);
        xhttp.send();
      }

      function star(id){
        if(Cookies.get("saved") == undefined){
          Cookies.set("saved", [id], {expires:365});
        }else{
          var arr = Cookies.getJSON("saved");
          if(arr.indexOf(id) == -1){
            $.snackbar({content: "Starred Cat"});
            arr.push(id);
            Cookies.set("saved", arr, {expires:365});
          }
        }
      }

      function checkStarred(id){
        var starred = Cookies.getJSON('saved');
        if(starred != undefined){
          var inThere = false;
          for(var i = 0; i < starred.length; i++){
            if(starred[i] == id){
              inThere = true;
              setStarButton(false);
              break;
            }
          }
          if(!inThere){
            setStarButton(true);
          }
        }
      }

      function setStarButton(on){
        var btn = document.getElementById("star-btn");
        if(on){
          btn.innerHTML = 'Star Cat &nbsp; <span class="glyphicon glyphicon-star"></span>';
          starred = false;
          // btn.onclick = function(){unstarCurrent()};
        }else{
          btn.innerHTML = 'Unstar Cat &nbsp; <span class="glyphicon glyphicon-star-empty"></span>'
          starred = true;
          // btn.onclick = function(){starCurrent()};
        }
      }

      function unstar(id){
        var arr = Cookies.getJSON("saved");
        var index = arr.indexOf(id);
        arr.splice(index,1);
        Cookies.set("saved", arr, {expires:365});

        $.snackbar({content: "Unstarred Cat"});
      }

      function unstarCurrent(){
        unstar(currentCatId);
        checkStarred(currentCatId);
      }

      function starCurrent(){

        // $("#star-overlay").delay(100);
        // $("#star-overlay").css("display", "none");
        if(starred){
          $("#overlaid-star").addClass("glyphicon-star-empty");
          $("#star-overlay").fadeIn(200).delay(200).fadeOut(200);
          unstarCurrent();
        }else{
          $("#overlaid-star").removeClass("glyphicon-star-empty");
          $("#star-overlay").fadeIn(200).delay(200).fadeOut(200);
          star(currentCatId);
          checkStarred(currentCatId);
        }
        // document.getElementById("star-btn").disabled = true;
      }
      $("#star-overlay").fadeOut(0);
      /* get the first cat */
      // get();
      nextCat();

      // $( "#cat" ).dblclick(function() {
      //   starCurrent();
      // });
      $(function() {
          $("#cat").swipe( {
            tap:function(event, target) {

            },
            doubleTap:function(event, target) {
              if(target.id == "cat"){
                starCurrent();
              }
            },
            longTap:function(event, target) {

            },
            threshold:50
          });
      });

    </script>



  </body>

</html>
