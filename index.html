<!DOCTYPE html>


<html>

  <head>
    <title>Random Cat</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-material-design.min.css" rel="stylesheet">
    <link href="css/ripples.min.css" rel="stylesheet">
    <link href="css/snackbar.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  </head>

  <body>
    <style>
      html, body{
        margin:0px;
        border:0px;
        padding:0px;
      }
      #cat{
        width: 100%;
        max-width:100%;
      }
      a[disabled] {
        pointer-events: none;
      }
    </style>

    <nav class="navbar navbar-primary">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapsed-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
         <a class="navbar-brand" href="#">Random Cat <sup><small>BETA</small></sup></a>
       </div>

       <div class="collapse navbar-collapse" id="collapsed-navbar">
        <ul class="nav navbar-nav">
          <li class="active"><a href="index.html">Home <span class="sr-only">(current)</span></a></li>
          <li><a href="saved.html">Starred</a></li>
          <li><a href="search.html">Search</a></li>
        </ul>
      </div>

     </div>
    </nav>

    <div class="col-md-7 col-md-offset-1">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h2 id="picture-title" class="panel-title">Random Cat</h2>
        </div>
        <div class="panel-body">
          <img src="loading.gif" id="cat"/>
        </div>
      </div>
    </div>

    <div class="col-md-offset-1 col-md-3">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">Random Cat</h3>
        </div>
        <div class="panel-body">
          <p>
              <button id="next-cat" type="button" class="btn btn-lg btn-block btn-primary" onclick="get()">
                Next cat&nbsp;<span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
              </button>
          </p>

          <p>
            <a id="download-link" href="loading.gif" download>
              <button id="download-btn" type="button" class="btn btn-lg btn-block btn-primary">
                Download&nbsp;<span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
              </button>
            </a>
          </p>

          <p>
            <button type="button" class="btn btn-lg btn-primary btn-block" onclick="starCurrent()" id="star-btn">
              Star Cat &nbsp; <span class="glyphicon glyphicon-star"></span>
            </button>
          </p>

          <p>
            <a href="" id="sourcelink">
              <button id="view-btn" type="button" class="btn btn-lg btn-primary btn-block">
                View Cat &nbsp;<span class="glyphicon glyphicon-eye-open"></span>
              </button>
            </a>
          </p>

          <div class="input-group">
            <span class="input-group-addon">URL</span>
            <input id="sourceurl" type="text" class="form-control" readonly value="">
          </div>

          <!-- <p>
            <a href="saved.html">
              <button type="button" class="btn btn-lg btn-block btn-primary">
                View Starred Cats
              </button>
            </a>
          </p> -->
        </div>
      </div>

      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">About Random Cat</h3>
        </div>
        <div class="panel-body">
          <p>
            <small>
              <p>
                Special thanks to <a href="http://thecatapi.com/">The Cat API</a>
              </p>
              <p>
                <a href="https://jquery.com/">jQuery</a>
                |
                <a href="http://getbootstrap.com/">Bootstrap</a>
                |
                <a href="http://fezvrasta.github.io/bootstrap-material-design/">Bootstrap Theme</a>
              </br>

                <a href="https://github.com/FezVrasta/snackbarjs">Snackbar</a>
                |
                <a href="http://bootboxjs.com/">Bootbox</a>
                |
                <a href="https://github.com/js-cookie/js-cookie">js-cookie</a>
              </p>
              <p>
                Made by <a href="https://github.com/alexoro412/"> alexoro412</a>
              </p>
              <p>
                This site uses cookies for keeping your starred cats
              </p>
              <p>
                I take no responsbility for any of these pictures whatsoever
              </p>
            </small>
          </p>
        </div>
      </div>
    </div>


    <script src="js/jquery-2.2.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/snackbar.min.js"></script>
    <script src="js/js-cookie.js"></script>
    <script src="js/bootbox.js"></script>
    <script src="js/ripples.min.js"></script>
    <script src="js/material.min.js"></script>
    <script>$.material.init();</script>


    <script>
      currentCatId = "";
      starred = false;

      if(Cookies.getJSON("saved") == undefined){
        Cookies.set("saved", []);
      }

      // if (window.location.protocol != "http:"){
      //   window.location.href = "http:" + window.location.href.substring(window.location.protocol.length);
      // }
      /**
      *   Takes an xml resonse from The Cat API and displays the cat
      */
      function displayCat(xml) {
          var xmlDoc = xml.responseXML;
          var img = document.getElementById("cat");
          img.src = xmlDoc.getElementsByTagName("url")[0].innerHTML;
          currentCatId = xmlDoc.getElementsByTagName("id")[0].innerHTML;
          var download_link = document.getElementById("download-link");
          download_link.href = xmlDoc.getElementsByTagName("url")[0].innerHTML;
          download_link.download = currentCatId;
          document.getElementById("next-cat").disabled = false;
          document.getElementById("download-btn").disabled = false;
          document.getElementById("sourceurl").value = "https://alexoro412.github.com/randomcat/single.html?id=" + currentCatId;
          document.getElementById("sourcelink").href = "single.html?id=" + currentCatId;
          document.getElementById("picture-title").innerHTML = xmlDoc.getElementsByTagName("id")[0].innerHTML;
          document.getElementById("star-btn").disabled = false;
          document.getElementById("view-btn").disabled = false;
          checkStarred(currentCatId);
      }

      /**
      *   Gets a random cat from The Cat API, then calls display cat
      */
      function get(){
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
              displayCat(xhttp);
            }
        };
        document.getElementById("star-btn").disabled = true;
        document.getElementById("next-cat").disabled = true;
        document.getElementById("sourcelink").href = "#";
        document.getElementById("sourceurl").value = "";
        document.getElementById("download-link").href = "#";
        document.getElementById("download-btn").disabled = true;
        document.getElementById("view-btn").disabled = true;
        document.getElementById("picture-title").innerHTML = "loading";
        var img = document.getElementById("cat");
        img.src = "loading.gif";
        xhttp.open("GET", "https://thecatapi.com/api/images/get?format=xml&results_per_page=1", true);
        xhttp.send();
      }

      function star(id){
        if(Cookies.get("saved") == undefined){
          Cookies.set("saved", [id], {expires:365});
        }else{
          var arr = Cookies.getJSON("saved");
          if(arr.indexOf(id) == -1){
            $.snackbar({content: "Starred Cat"});
            arr.push(id);
            Cookies.set("saved", arr, {expires:365});
          }
        }
      }

      function checkStarred(id){
        var starred = Cookies.getJSON('saved');
        if(starred != undefined){
          var inThere = false;
          for(var i = 0; i < starred.length; i++){
            if(starred[i] == id){
              inThere = true;
              setStarButton(false);
              break;
            }
          }
          if(!inThere){
            setStarButton(true);
          }
        }
      }

      function setStarButton(on){
        var btn = document.getElementById("star-btn");
        if(on){
          btn.innerHTML = 'Star Cat &nbsp; <span class="glyphicon glyphicon-star"></span>';
          starred = false;
          // btn.onclick = function(){unstarCurrent()};
        }else{
          btn.innerHTML = 'Unstar Cat &nbsp; <span class="glyphicon glyphicon-star-empty"></span>'
          starred = true;
          // btn.onclick = function(){starCurrent()};
        }
      }

      function unstar(id){
        var arr = Cookies.getJSON("saved");
        var index = arr.indexOf(id);
        arr.splice(index,1);
        console.log(arr);
        Cookies.set("saved", arr, {expires:365});

        $.snackbar({content: "Unstarred Cat"});
      }

      function unstarCurrent(){
        unstar(currentCatId);
        checkStarred(currentCatId);
      }

      function starCurrent(){
        if(starred){
          unstarCurrent();
        }else{
          star(currentCatId);
          checkStarred(currentCatId);
        }
        // document.getElementById("star-btn").disabled = true;
      }

      /* get the first cat */
      get();

      $( "#cat" ).dblclick(function() {
        starCurrent();
      });

    </script>



  </body>

</html>
