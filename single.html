<!DOCTYPE html>


<html>

  <head>
    <title>Random Cat</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-material-design.min.css" rel="stylesheet">
    <link href="css/ripples.min.css" rel="stylesheet">
    <link href="css/snackbar.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  </head>
  <body>
    <style>
      html, body{
        margin:0px;
        border:0px;
        padding:0px;
      }
      #cat{
        width: 100%;
        max-width:100%;
      }
      a[disabled] {
        pointer-events: none;
      }
      #star-overlay{
        position:fixed;
        text-align: center;
        /*opacity: 0.5;*/
        /*background-color: #ffffff;*/
        width:100%;
        height:100%;
        z-index:12;
        display: table;
        /*display: none;*/
        /*vertical-align: middle;*/
      }
      #actual-overlay{
        position:fixed;
        text-align: center;
        opacity: 0.5;
        background-color: #ffffff;
        width:100%;
        height:100%;
        z-index:12;
        display: table;
        /*vertical-align: middle;*/
      }
      #star-overlay > span{
        display: table-cell;
        vertical-align: middle;
        font-size:1000%;
        color: rgba(200, 200, 200, 1);
        /*opacity: 0;*/
        /*width: auto;
        height: auto;*/
        /*opacity: 1 !important;*/
      }
    </style>

    <div id="star-overlay" >
      <div id="actual-overlay"></div>
      <span id="overlaid-star" class="glyphicon glyphicon-star"></span>
    </div>

    <nav class="navbar navbar-primary">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapsed-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
         <a class="navbar-brand" href="index.html">Random Cat <sup><small>BETA</small></sup></a>
       </div>

       <div class="collapse navbar-collapse" id="collapsed-navbar">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="saved.html">Starred</a></li>
          <li><a href="search.html">Search</a></li>
        </ul>
      </div>

     </div>
    </nav>

    <!-- <div class="col-md-7 col-md-offset-1">
        <a href="index.html" id="back">
          <button type="button" class="btn btn-primary btn-block btn-raised">
            <span class="glyphicon glyphicon-arrow-left"></span> <span id="back-text">Back to Browse</span>
          </button>
        </a>
    </div> -->

    <div class="col-md-7 col-md-offset-1">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h2 id="picture-title" class="panel-title">Random Cat</h2>
        </div>
        <div class="panel-body">
          <img src="loading.gif" id="cat"/>
        </div>
      </div>
    </div>

    <div class="col-md-offset-1 col-md-3">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">Random Cat</h3>
        </div>
        <div class="panel-body">
          <p>
            <a id="download-link" href="loading.gif" download>
              <button id="download-btn" type="button" class="btn btn-lg btn-block btn-primary">
                Download&nbsp;<span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
              </button>
            </a>
          </p>

          <p>
            <button type="button" class="btn btn-lg btn-primary btn-block" onclick="starCurrent()" id="star-btn">
              Star Cat &nbsp; <span class="glyphicon glyphicon-star"></span>
            </button>
          </p>
          <p>
            <a href="" id="sourcelink">
              <button id="view-btn" type="button" class="btn btn-lg btn-primary btn-block">
                <span>View Cat</span> &nbsp; <span class="glyphicon glyphicon-eye-open"></span>
              </button>
            </a>
          </p>

          <div class="input-group">
            <span class="input-group-addon">URL</span>
            <input id="sourceurl" type="text" class="form-control" readonly value="">
          </div>

          <!-- <p>
            <a href="saved.html">
              <button type="button" class="btn btn-lg btn-block btn-primary">
                View Starred Cats
              </button>
            </a>
          </p> -->
        </div>
      </div>

      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">About Random Cat</h3>
        </div>
        <div class="panel-body">
          <p>
            <small>
              <p>
                Special thanks to <a href="https://thecatapi.com/">The Cat API</a>
              </p>
              <p>
                <a href="https://jquery.com/">jQuery</a>
                |
                <a href="http://getbootstrap.com/">Bootstrap</a>
                |
                <a href="http://fezvrasta.github.io/bootstrap-material-design/">Bootstrap Theme</a>
              </br>

                <a href="https://github.com/FezVrasta/snackbarjs">Snackbar</a>
                |
                <a href="http://bootboxjs.com/">Bootbox</a>
                |
                <a href="https://github.com/js-cookie/js-cookie">js-cookie</a>
              </p>
              <p>
                Made by <a href="https://github.com/alexoro412/"> alexoro412</a>
              </p>
              <p>
                This site uses cookies for keeping your starred cats
              </p>
              <p>
                I take no responsbility for any of these pictures whatsoever
              </p>
            </small>
          </p>
        </div>
      </div>
    </div>

    <script src="js/jquery-2.2.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/snackbar.min.js"></script>
    <script src="js/js-cookie.js"></script>
    <script src="js/bootbox.js"></script>
    <script src="js/ripples.min.js"></script>
    <script src="js/material.min.js"></script>
    <script src="js/jquery.touchSwipe.js"></script>
    <script>$.material.init();</script>
    <script>

    currentCatId = "";
    starred = false;

    if(Cookies.getJSON("saved") == undefined){
      Cookies.set("saved", []);
    }

    // if (window.location.protocol != "http:"){
    //   window.location.href = "http:" + window.location.href.substring(window.location.protocol.length);
    // }

    var QueryString = function () {
      // This function is anonymous, is executed immediately and
      // the return value is assigned to QueryString!
      var query_string = {};
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
            // If first entry with this name
        if (typeof query_string[pair[0]] === "undefined") {
          query_string[pair[0]] = decodeURIComponent(pair[1]);
            // If second entry with this name
        } else if (typeof query_string[pair[0]] === "string") {
          var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
          query_string[pair[0]] = arr;
            // If third or later entry with this name
        } else {
          query_string[pair[0]].push(decodeURIComponent(pair[1]));
        }
      }
        return query_string;
    }();

    document.getElementById("cat").src = "https://thecatapi.com/api/images/get?image_id=" + QueryString.id;
    document.getElementById("picture-title").innerHTML = QueryString.id;
    currentCatId = QueryString.id;
    document.getElementById("download-link").href = "https://thecatapi.com/api/images/get?image_id=" + QueryString.id;
    document.getElementById("download-link").download = currentCatId;
    document.getElementById("sourcelink").href = "single.html?id=" + QueryString.id;
    document.getElementById("sourceurl").value = "https://alexoro412.github.com/randomcat/single.html?id=" + QueryString.id;

    if(QueryString.fromStarred != undefined){
      document.getElementById("back").href = "saved.html";
      document.getElementById("back-text").innerHTML = "Back to Starred";
    }else if(QueryString.fromSearch != undefined){
      // console.log("h");
      document.getElementById('back').href = "search.html";
      document.getElementById('back-text').innerHTML = "Back to Search";
    }else{
      document.getElementById("view-btn").style.display = "none";
      document.getElementById("sourcelink").style.display = "none";
    }

    function star(id){
      if(Cookies.get("saved") == undefined){
        Cookies.set("saved", [id], {expires:365});
      }else{
        var arr = Cookies.getJSON("saved");
        if(arr.indexOf(id) == -1){
          $.snackbar({content: "Starred Cat"});
          arr.push(id);
          Cookies.set("saved", arr, {expires:365});
        }
      }
    }

    function checkStarred(id){
      var starred = Cookies.getJSON('saved');
      if(starred != undefined){
        var inThere = false;
        for(var i = 0; i < starred.length; i++){
          if(starred[i] == id){
            inThere = true;
            setStarButton(false);
            break;
          }
        }
        if(!inThere){
          setStarButton(true);
        }
      }
    }

    function setStarButton(on){
      var btn = document.getElementById("star-btn");
      if(on){
        btn.innerHTML = 'Star Cat &nbsp; <span class="glyphicon glyphicon-star"></span>';
        starred = false;
        // btn.onclick = function(){unstarCurrent()};
      }else{
        btn.innerHTML = 'Unstar Cat &nbsp; <span class="glyphicon glyphicon-star-empty"></span>'
        starred = true;
        // btn.onclick = function(){starCurrent()};
      }
    }

    function unstar(id){
      var arr = Cookies.getJSON("saved");
      var index = arr.indexOf(id);
      arr.splice(index,1);
      console.log(arr);
      Cookies.set("saved", arr, {expires:365});

      $.snackbar({content: "Unstarred Cat"});
    }

    function unstarCurrent(){
      unstar(currentCatId);
      checkStarred(currentCatId);
    }

    function starCurrent(){

      // $("#star-overlay").delay(100);
      // $("#star-overlay").css("display", "none");
      if(starred){
        $("#overlaid-star").addClass("glyphicon-star-empty");
        $("#star-overlay").fadeIn(200).delay(200).fadeOut(200);
        unstarCurrent();
      }else{
        $("#overlaid-star").removeClass("glyphicon-star-empty");
        $("#star-overlay").fadeIn(200).delay(200).fadeOut(200);
        star(currentCatId);
        checkStarred(currentCatId);
      }
      // document.getElementById("star-btn").disabled = true;
    }

    $("#star-overlay").fadeOut(0);

    $(function() {
        $("#cat").swipe( {
          tap:function(event, target) {

          },
          doubleTap:function(event, target) {
            if(target.id == "cat"){
              starCurrent();
            }
          },
          longTap:function(event, target) {

          },
          threshold:50
        });
    });

    checkStarred(currentCatId);

    </script>
  </body>
</html>
